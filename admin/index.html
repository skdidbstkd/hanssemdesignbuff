<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>DesignBuff CMS Admin</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body{font-family:system-ui,-apple-system,"Noto Sans KR",sans-serif;margin:0}
    #loading{display:flex;align-items:center;justify-content:center;height:100vh;color:#444}
    #err{display:none;padding:16px 20px;margin:24px;border:1px solid #f5c2c7;background:#fff5f5;color:#b4232a;border-radius:8px}
  </style>
  <!-- 수동 초기화 -->
  <script>window.CMS_MANUAL_INIT = true;</script>

  <!-- ★ 검증된 안정판(2.x) 사용: CDN 한 줄만 -->
  <script defer src="https://cdn.jsdelivr.net/npm/decap-cms@2.15.65/dist/decap-cms.js"></script>
</head>
<body>
  <div id="loading">관리자 화면 불러오는 중… (최대 5초)</div>
  <div id="err"></div>

  <script>
    // 8초 넘으면 안내
    const timer = setTimeout(()=>err('로딩 지연: 강력 새로고침(Ctrl/Cmd+Shift+R) 후 재시도하세요.'), 8000);

    function err(m){ const e=document.getElementById('err'); e.style.display='block'; e.textContent=m; }

    // 스크립트 로드 완료 시점에만 초기화
    window.addEventListener('load', function(){
      if(!window.CMS){ err('CMS 스크립트를 불러오지 못했습니다.'); return; }
      try{
        clearTimeout(timer);
        const loading=document.getElementById('loading'); if(loading) loading.remove();

        // GitHub Pages 하위경로 → 상대경로로 단순화 (admin/ 에 있으니 OK)
        CMS.init({ config: 'config.yml' });
      }catch(e){ err('초기화 오류: '+(e?.message||e)); }
    }, { once:true });

    // 전역 스크립트 에러도 안내
    window.addEventListener('error', (ev)=>err('스크립트 에러: '+(ev?.message||'')), true);
  </script>
</body>
</html>
